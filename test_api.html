<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT API Test</title>
    <link rel="icon" type="image/png" href="3.png">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-box { border: 1px solid #ccc; padding: 20px; margin: 10px 0; }
        .success { border-color: green; background: #f0fff0; }
        .error { border-color: red; background: #fff0f0; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>GPT API Test</h1>
    
    <div class="test-box">
        <h3>API Key Test</h3>
        <button onclick="testAPIKey()">Test GPT-5 API Key</button>
        <div id="api-result"></div>
    </div>

    <div class="test-box">
        <h3>Model Availability Test</h3>
        <button onclick="testModels()">Check Available Models</button>
        <div id="model-result"></div>
    </div>

    <div class="test-box">
        <h3>Chat Test</h3>
        <input type="text" id="test-message" placeholder="Test message" style="width: 300px; padding: 5px;">
        <button onclick="testChat()">Send Test Message</button>
        <div id="chat-result"></div>
    </div>

    <script>
        const API_KEY = 'your-openai-api-key-here';

        async function testAPIKey() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = 'Testing...';

            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `<div class="success">✅ API Key Valid - Found ${data.data.length} models</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ API Key Invalid - Status: ${response.status}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        }

        async function testModels() {
            const resultDiv = document.getElementById('model-result');
            resultDiv.innerHTML = 'Checking models...';

            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const gptModels = data.data.filter(model => model.id.includes('gpt')).map(m => m.id);
                    const hasGPT5 = gptModels.some(id => id.includes('gpt-5'));
                    
                    resultDiv.innerHTML = `
                        <div class="${hasGPT5 ? 'success' : 'error'}">
                            <strong>GPT Models Available:</strong><br>
                            ${gptModels.join('<br>')}
                            <br><br>
                            <strong>GPT-5 Available:</strong> ${hasGPT5 ? '✅ Yes' : '❌ No'}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ Failed to fetch models - Status: ${response.status}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        }

        async function testChat() {
            const message = document.getElementById('test-message').value || 'Hello, can you help me with ERP analysis?';
            const resultDiv = document.getElementById('chat-result');
            resultDiv.innerHTML = 'Sending message...';

            // Try GPT-5 variants first, then fallback models
            const modelsToTry = [
                { name: 'gpt-5', params: { reasoning_effort: 'medium' } },
                { name: 'gpt-5-mini', params: {} },
                { name: 'gpt-4', params: {} },
                { name: 'gpt-3.5-turbo', params: {} }
            ];

            for (const model of modelsToTry) {
                try {
                    resultDiv.innerHTML = `Testing ${model.name}...`;
                    
                    const requestBody = {
                        model: model.name,
                        messages: [
                            { role: 'system', content: 'You are CAPI-AI, an ERP co-pilot assistant.' },
                            { role: 'user', content: message }
                        ],
                        max_completion_tokens: 200,
                        temperature: 0.7,
                        ...model.params
                    };

                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${API_KEY}`
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        resultDiv.innerHTML = `
                            <div class="success">
                                <strong>✅ Success with ${model.name}:</strong><br>
                                <em>Request:</em> "${message}"<br>
                                <em>Response:</em> ${data.choices[0].message.content}
                            </div>
                        `;
                        return;
                    } else {
                        const errorData = await response.json().catch(() => ({}));
                        console.log(`${model.name} failed (${response.status}):`, errorData.error?.message || 'Unknown');
                        
                        if (model === modelsToTry[modelsToTry.length - 1]) {
                            resultDiv.innerHTML = `
                                <div class="error">
                                    ❌ All models failed. Last error (${model.name}): ${response.status} - ${errorData.error?.message || 'Unknown error'}
                                </div>
                            `;
                        }
                    }
                } catch (error) {
                    console.log(`${model.name} error:`, error.message);
                    if (model === modelsToTry[modelsToTry.length - 1]) {
                        resultDiv.innerHTML = `<div class="error">❌ All models failed with network errors</div>`;
                    }
                }
            }

            resultDiv.innerHTML = `<div class="error">❌ All models failed to respond</div>`;
        }
    </script>
</body>
</html>